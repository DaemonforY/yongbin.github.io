

本章首先通过引用数据仓库理论推动者Bill.Inmon和Kimball关于ODS的定义来阐述ODS系统的概念。

另一方面梳理了ODS和业务系统以及数据仓库这三者之间的关系：他们相互之间的差异、联系以及他们各自的作用。

最后，从实际生产场景出发说明了ODS和Staging Data Server的关系 以及发展历程。



# 1.1 ODS概念

  ODS全称是Operational Data Store，操作数据存储。

  根据Bill.Inmon的定义，ODS是一个面向主题的、集成的、可变的、当前的细节数据集合，用于支持企业对于即时性的、操作性的、集成的全体信息的需求。常常被作为数据仓库的过渡，也是数据仓库项目的可选项之一。

  而Kimball在《数据仓库生命周期工具集》中是这样定义ODS的：



- 操作型系统的集成，用于当前、历史以及其它细节查询(业务系统的一部分)；

  

- &为决策支持提供当前细节数据(数据仓库的一部分)。

  

  因此操作数据存储（ODS）是用于支持企业日常的全局应用的数据集合，ODS的数据具有面向主题、集成的、可变的以及数据是当前的或是接近当前的这4个基本特征。同样也可以看出ODS是介于DB和DW 之间的一种数据存储技术。

  特别需要注意的是，Kimball所说的ODS是物理落地在操作性系统（即是关系型数据库），但是在实际生产应用中，ODS往往是物理落地在数据仓库中，这块在后续ODS和Staging Data Server中会详细说明。

# ODS和业务系统（DB）、数据仓库（DW）的关系

  通常来说ODS是在数据仓库中存储业务系统源数据，所以从数据粒度、数据结构、数据关系等各个方面都和业务系统保持一致。但是ODS也不是业务系统的一个简单备份或者镜像，ODS和业务系统的差异主要是由于两者之间面向业务需求是不同的，业务系统是面向多并发读写同时有需要满足数据的一致性，而ODS数据通常是面向数据报表等批量数据查询需求：

  1）数据集成方式不同，ODS不像业务系统那样由于性能压力需要对同一个逻辑表进行分表分库操作，也不会根据业务划分在物理上进行分库分表。ODS会将业务系统中同一个逻辑表统一到一个物理实体中存储，并且会对重复冗余、不符合业务规则的脏数据进行清洗，统一编码。

  2）业务系统在数据组织上需要严格遵守三范式，并且需要创建相对复杂的索引结构来提升系统效率。而ODS在数据主外键约束和索引结构上不需要投入大量的系统资源

  3）两者存储系统不一，通常业务系统用的都是oralce、MySQL、DB2等以事务性处理见长数据库系统，ODS通常落地在Hadoop等分布式系统或者类似teradata等MPP数据系统。

  和原来面向应用的、分散的业务系统相比，ODS中的数据组织方式和数据仓库（DW）一样也是面向主题的和集成的，所以对进入ODS的数据也进入数据仓库的数据一样进行集成处理。面向主题和集成性得ODS数据在静态特征上很接近DW中的数据，但是在ODS与DW 之间仍然有许多基本的、重要的差别：

  ODS只是存放当前或接近当前的数据，如果需要的话还可以对ODS中的数据进行增、删和更新等操作，虽然DW中的数据也是面向主题和集成的，但这些数据一般不进行修改，所以ODS和DW的区别主要体现数据的可变性、当前性、稳定性、汇总度上。

# ODS和Staging Data Server的关系

  Staging Data Server 可以说是大型数据仓库的一个很重要的选项,其数据结构和内容与业务系统是一模一样的,这么做主要是为了减少对业务系统的压力,并让ETL (数据抽取、转换、清洗、装载) 过程有一个统一的接口。

  Staging Data Server 是一个虚拟的概念，它可以是一个单独的服务器,也可以驻留在业务系统或数据仓库的数据库服务器上,一般是不允许用户访问的。而里面的内容一般是临时性的,抽取到数据仓库后删除或者在下一次更新抽取前删除。

  在很多情况下,Staging Data Server 是逻辑的,但是对于数据源特别复杂的情况,建议采用Staging Data Server 可以实现统一的ETL 接口，并且屏蔽ETL对源系统的影响。同时也能解决“对业务系统来说,数据是分散的,用户无法得到统一的、全面的、集成的数据展现”这个问题。因此有人就把Staging Data Server 作为ODS ，但是这样的话ODS 就比较偏向业务系统，无法实现“面向主题”和“用于历史细节查询”的需求。

  因此进一步有一种做法是建立Persistent Staging(永久数据) ,数据是不断累积的，Persistent Staging 相当于是对业务系统数据不断进行镜像备份，不仅满足了面向当前，也能承担面向历史的细节查询，面向主题的集成工作还是交给后续的数据仓库应用来完成。这种做法是当前大部分大型数据仓库比较流行的方式，稍微进一步的做法是对Persistent Staging的数据按主题进行一个初步的划分并对其进行数据质量处理，但是不会去做额外的按主题集成数据工作。从ETL的角度说，就是只做E和L的工作，T的工作只是一些数据质量处理。

  但是这样做的最主要的问题就是需要消耗极大存储成本，所以往往使用Persistent Staging，系统物理都是落地在数据仓库中的，通常就是用目前比较流行的云存储。